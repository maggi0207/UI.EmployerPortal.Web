@page "/business-information"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Components.Forms
@using UI.EmployerPortal.Web.Features.EmployerRegistration.Components
@using UI.EmployerPortal.Web.Features.EmployerRegistration.Models
@inject NavigationManager Nav

<PageTitle>Business Information</PageTitle>

<div class="page_wrapper">
    <div class="bi-page-content">

        <h1 class="page-title">Business Information</h1>
        <p class="page-subtitle">All fields are required unless noted</p>

        <EditForm EditContext="@editContext"
                  OnValidSubmit="GoNext"
                  OnInvalidSubmit="OnInvalid"
                  FormName="BusinessInformation">

            <DataAnnotationsValidator />

            <!-- Top Error Banner -->
            @if (formSubmitted && editContext?.GetValidationMessages().Any() == true)
            {
                <MasterAlert State="error"
                             Title="Missing information"
                             Body="Please correct the errors below" />
            }

            <!-- ================= BUSINESS DETAILS ================= -->
            <div class="bi-fields-grid">

                <OutlinedTextField Label="FEIN"
                                   @bind-Value="Model.FEIN"
                                   For="() => Model.FEIN"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.FEIN)" Visible="formSubmitted" />

                <OutlinedTextField Label="Legal Name"
                                   @bind-Value="Model.LegalName"
                                   For="() => Model.LegalName"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.LegalName)" Visible="formSubmitted" />

                <OutlinedTextField Label="Trade Name (Optional)"
                                   @bind-Value="Model.TradeName" />

                <OutlinedTextField Label="Phone Number"
                                   Type="tel"
                                   @bind-Value="Model.PhoneNumber"
                                   For="() => Model.PhoneNumber"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.PhoneNumber)" Visible="formSubmitted" />

                <OutlinedTextField Label="Email Address"
                                   Type="email"
                                   @bind-Value="Model.Email"
                                   For="() => Model.Email"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.Email)" Visible="formSubmitted" />

            </div>

            <!-- ================= MAILING ADDRESS ================= -->
            <div class="bi-section-header">
                <span>Business Mailing Address</span>
            </div>

            <div class="bi-fields-grid">

                <OutlinedSelectField Label="Country"
                                     @bind-Value="Model.MailingCountry"
                                     Options="Countries"
                                     For="() => Model.MailingCountry"
                                     Visible="formSubmitted" />
                <FieldError For="@(() => Model.MailingCountry)" Visible="formSubmitted" />

                <OutlinedTextField Label="Address Line 1"
                                   @bind-Value="Model.MailingAddressLine1"
                                   For="() => Model.MailingAddressLine1"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.MailingAddressLine1)" Visible="formSubmitted" />

                <OutlinedTextField Label="Address Line 2 (Optional)"
                                   @bind-Value="Model.MailingAddressLine2" />

                <OutlinedTextField Label="City"
                                   @bind-Value="Model.MailingCity"
                                   For="() => Model.MailingCity"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.MailingCity)" Visible="formSubmitted" />

                <OutlinedSelectField Label="State"
                                     @bind-Value="Model.MailingState"
                                     Options="States"
                                     For="() => Model.MailingState"
                                     Visible="formSubmitted" />
                <FieldError For="@(() => Model.MailingState)" Visible="formSubmitted" />

                <OutlinedTextField Label="Zip Code"
                                   @bind-Value="Model.MailingZip"
                                   For="() => Model.MailingZip"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.MailingZip)" Visible="formSubmitted" />

            </div>

            <!-- ================= PHYSICAL LOCATION ================= -->
            <div class="bi-section-header">
                <span>Physical Location 1</span>
            </div>

            <div class="bi-fields-grid">

                <OutlinedSelectField Label="Country"
                                     @bind-Value="Model.PhysicalCountry"
                                     Options="Countries"
                                     For="() => Model.PhysicalCountry"
                                     Visible="formSubmitted" />
                <FieldError For="@(() => Model.PhysicalCountry)" Visible="formSubmitted" />

                <OutlinedTextField Label="Address Line 1"
                                   @bind-Value="Model.PhysicalAddressLine1"
                                   For="() => Model.PhysicalAddressLine1"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.PhysicalAddressLine1)" Visible="formSubmitted" />

                <OutlinedTextField Label="Address Line 2 (Optional)"
                                   @bind-Value="Model.PhysicalAddressLine2" />

                <OutlinedTextField Label="City"
                                   @bind-Value="Model.PhysicalCity"
                                   For="() => Model.PhysicalCity"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.PhysicalCity)" Visible="formSubmitted" />

                <OutlinedSelectField Label="State"
                                     @bind-Value="Model.PhysicalState"
                                     Options="States"
                                     For="() => Model.PhysicalState"
                                     Visible="formSubmitted" />
                <FieldError For="@(() => Model.PhysicalState)" Visible="formSubmitted" />

                <OutlinedTextField Label="Zip Code"
                                   @bind-Value="Model.PhysicalZip"
                                   For="() => Model.PhysicalZip"
                                   Visible="formSubmitted" />
                <FieldError For="@(() => Model.PhysicalZip)" Visible="formSubmitted" />

            </div>

            <!-- ================= BUTTON BAR ================= -->
            <ButtonBar ShowBack="true"
                       ShowContinue="true"
                       OnBack="GoBack"
                       ContinueEnabled="true"
                       Buttonwidth="112px" />

        </EditForm>
    </div>
</div>

@code {

    private BusinessInformationModel Model = new();
    private EditContext editContext = default!;
    private bool formSubmitted = false;

    protected List<SelectOption> Countries { get; set; } = new()
    {
        new() { Value = "United States", Text = "United States" },
        new() { Value = "Canada", Text = "Canada" },
        new() { Value = "Mexico", Text = "Mexico" }
    };

    protected List<SelectOption> States { get; set; } = new()
    {
        new() { Value = "AL", Text = "Alabama" },
        new() { Value = "CA", Text = "California" },
        new() { Value = "NY", Text = "New York" },
        new() { Value = "TX", Text = "Texas" }
    };

    protected override void OnInitialized()
    {
        editContext = new EditContext(Model);

        editContext.OnFieldChanged += (_, __) =>
        {
            StateHasChanged();
        };
    }

    private void GoBack()
    {
        Nav.NavigateTo("/ownership");
    }

    private void GoNext()
    {
        Nav.NavigateTo("/address-correction");
    }

    private void OnInvalid()
    {
        formSubmitted = true;
        StateHasChanged();
    }
}
